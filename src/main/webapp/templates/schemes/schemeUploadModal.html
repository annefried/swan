<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link href="css/explorer.css" rel="stylesheet">
    </head>
    <body>
        <!-- Project Modal -->
        <form role="form">
            <div class="modal-header">
                <h3 class="modal-title" id="myModalLabel">Scheme builder</h3>
            </div>
            <div class="col-lg-6">
                <uib-alert ng-repeat="alert in alerts"
                           type="{{alert.type}}"
                           dismiss-on-timeout="10000"
                           close="closeAlert($index)">
                    {{alert.msg}}
                </uib-alert>
            </div>
            <div class="modal-body">
                <!-- 1. row -->
                <div class="row">
                    <div class="form-group col-lg-6">
                        <input ng-model="collapseUpload" type="checkbox" id="sb_createFromExisting">
                        <label for="sb_createFromExisting">Create from existing scheme</label>
                    </div>

                    <!-- Upload scheme or select from existing schemes -->
                    <div class="form-group col-lg-12" ng-show="collapseUpload">
                        <div class="sb_left">
                            <label>Load existing scheme from database...</label>
                            <div class="sb_inputText">
                                <select class="form-control input-sm"
                                        ng-model="preloadedScheme" 
                                        ng-options="scheme as scheme.name for scheme in this.loadedSchemes">           
                                </select>
                            </div>
                            <button class="btn btn-success btn-sm" 
                                    type="button"
                                    ng-click="loadPreloadedScheme(preloadedScheme);"
                                    ng-disabled="preloadedScheme === undefined"
                                    id="sb_loadbutton">
                                Load scheme
                            </button>
                        </div>
                        <div class="sb_right">
                            <label>... or upload scheme (json/xml):</label>
                            <input class="btn btn-default btn-file"
                                   type="file"
                                   ng-model="file"  
                                   name="scheme"
                                   accept=".xml,.json"
                                   on-read-file="this.saveScheme($fileContent)"/>
                        </div>

                    </div>
                </div>
                <hr/>
                
                <div class="row">
                    <!-- Scheme name -->
                    <div class="form-group col-lg-9">
                        <div class="form-group">
                            <label>Scheme name:</label>
                            <input type="text" id="scheme-name-input"
                                   placeholder="Enter name..." 
                                   class="form-control sb_inputName"
                                   ng-model="name"/>
                        </div>
                    </div>
                </div>
                <hr>
                
                <label>Select the visualization kind:</label>
                <div class="row">
                    <div class="form-group col-lg-6">
                        <input type="checkbox" 
                               ng-model="graphView.checked"
                               ng-true-value="true"
                               ng-false-value="false"
                               id="cb_graph">
                        <label for="cb_graph">Graph</label>
                    </div>
                    <div class="form-group col-lg-6">
                        <input type="checkbox"
                               ng-model="timelineView.checked"
                               ng-true-value="true"
                               ng-false-value="false"
                               id="cb_timeline">
                        <label for="cb_timeline">Timeline</label>
                    </div>
                    <!--
                    <div class="form-group col-lg-6">
                        <input ng-model="collapseTree" type="checkbox" id="cb_graph">
                        <label for="cb_graph">Graph</label>
                    </div>-->
                    
                    <div class="form-group col-lg-6 sb_left" ng-show="graphView.checked">
                        <div class="radio">
                            <label>
                                <input type="radio"
                                       name="optradioGraph"
                                       ng-model="graphView.state"
                                       value="opened"
                                       checked="checked">
                                is open
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio"
                                       name="optradioGraph"
                                       ng-model="graphView.state"
                                       value="closed">
                                is closed
                            </label>
                        </div>
                    </div>
                    <div class="form-group col-lg-6 sb_right" ng-show="timelineView.checked">
                        <div class="radio">
                            <label>
                                <input type="radio"
                                       name="optradioTimeline"
                                       ng-model="timelineView.state"
                                       value="opened"
                                       checked="checked">
                                is open
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                <input type="radio"
                                       name="optradioTimeline"
                                       ng-model="timelineView.state"
                                       value="closed">
                                is closed
                            </label>
                        </div>
                    </div>
                </div>
                <hr/>
                
                <div class="row">
                    <!-- Target Types -->
                    <div class="form-group col-lg-7">
                        <div class="form-group" >
                            <label>
                                Annotation types:
                            </label>
                            <table class="listingTable">
                                <tbody>
                                    <tr ng-repeat="target in this.targets">
                                        <td class="tableRowWithGlyph">
                                            {{target}}
                                        </td>
                                        <td>
                                            <span class="glyphicon glyphicon-remove"
                                                  style="color:red;" 
                                                  ng-click="removeTargeType(target)">
                                            </span>
                                        </td>
                                    </tr>  
                                </tbody>
                            </table>
                        </div>
                        <div class="input-group col-lg-6 sb_inputName">
                            <input type="text" ng-model="targetTypeToAdd" 
                                   class="form-control input-sm" 
                                   placeholder="Enter type name...">
                            <span class="input-group-btn">
                                <button class="btn btn-default btn-sm" 
                                        type="button"  id="annotation-types-input"
                                        ng-disabled="targetTypeToAdd === undefined"
                                        ng-click="addTargetType(targetTypeToAdd)">
                                    Add
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
                <hr/>
                
                <div class="row">
                    <div class="form-group col-lg-12" >
                        <label>
                            Label sets
                        </label>
                        <table class="form-group labelLinkSetTable table">
                            <thead class="headDark">
                            <th class="col-md-2">
                                name
                            </th>
                            <th class="col-md-1">
                                exclusive?
                            </th>
                            <th class="col-md-2">
                                types
                            </th>
                            <th class="col-md-1">
                                labels
                            </th>
                            <th class="col-md-1"/>
                            </thead>
                            <tbody>
                                <tr ng-repeat="labelSet in labelSets">
                                    <td>
                                        {{labelSet.name}}
                                    </td>
                                    <td>
                                        {{labelSet.exclusive}}
                                    </td>
                                    <td>
                                        <p ng-repeat="target in labelSet.appliesToTargetTypes">
                                            {{target}}
                                        </p>
                                    </td>
                                    <td>
                                        <p ng-repeat="label in labelSet.labels">
                                            {{label}}
                                        </p>
                                    </td>
                                    <td>
                                        <span class="glyphicon glyphicon-edit"
                                              ng-click="editLabelSet(labelSet.name)">
                                        </span>
                                        <span class="glyphicon glyphicon-remove"
                                              style="color:red;"
                                              ng-click="removeLabelSet(labelSet.name)">
                                        </span>
                                    </td>
                                </tr>  
                            </tbody>
                        </table>
                        <hr/>
                        <label>
                            Link sets
                        </label>
                        <table class="form-group labelLinkSetTable table">
                            <thead class="headDark">
                            <th class="col-md-2">
                                name
                            </th>
                            <th class="col-md-1">
                                start type
                            </th>
                            <th class="col-md-1">
                                end type
                            </th>
                            <th class="col-md-2">
                                labels
                            </th>
                            <th class="col-md-1" />
                            </thead>
                            <tbody>
                                <tr ng-repeat="linkSet in linkSets">
                                    <td>
                                        {{linkSet.name}}
                                    </td>
                                    <td>
                                        {{linkSet.startType}}
                                    </td>
                                    <td>
                                        {{linkSet.endType}}
                                    </td>
                                    <td> 
                                        <p ng-repeat="label in linkSet.linkLabels">
                                            {{label}}
                                        </p>
                                    </td>
                                    <td>
                                        <span class="glyphicon glyphicon-edit" 
                                              ng-click="editLinkSet(linkSet)">
                                        </span>
                                        <span class="glyphicon glyphicon-remove" 
                                              style="color:red;"
                                              ng-click="removeLinkSet(linkSet)">
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <hr>
                
                <div class="row">
                    <!-- Label Sets -->
                    <div class="form-group col-xs-6 sb_left vr_right" id="addLabelSetsDiv">
                        <label>
                            Add or modify label sets:
                        </label>
                        <div class="form-group">
                            <label>
                                Name:
                            </label>
                            <input type="text" placeholder="Enter name...." 
                                   class="form-control input-sm" 
                                   ng-model="nameLabelSet"/>
                        </div>
                        <div class="form-group">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox"
                                           ng-init="exclusiveLabelSet = false"
                                           ng-model="exclusiveLabelSet">
                                    exclusive
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                Applies to annotation types:
                            </label>
                            <table class="listingTable form-group">
                                <tbody>
                                    <tr ng-repeat="target in this.selectedTargetsLabel">
                                        <td class="tableRowWithGlyph">
                                            {{target}}
                                        </td>
                                        <td>
                                            <span class="glyphicon glyphicon-remove"
                                                  style="color:red;"
                                                  ng-click="removeTargetTypeLabel(target)">
                                            </span>
                                        </td>
                                    </tr>  
                                </tbody>
                            </table>
                            <div class = "btn-group">
                                <button type = "button" class="btn btn-default dropdown-toggle btn-sm"
                                        data-toggle = "dropdown">
                                    Add annotation type
                                    <span class = "caret">
                                    </span>
                                </button>
                                <ul class = "dropdown-menu" role = "menu">
                                    <li  ng-repeat="target in this.targets| filter:selectedTargetsLabelFilter">
                                        <a ng-click="addTargetTypeLabel(target);">
                                            {{target}}
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                Labels:
                            </label>
                            <table class="listingTable form-group">
                                <tbody>
                                    <tr ng-repeat="label in this.currentLabelSet">
                                        <td class="tableRowWithGlyph">
                                            {{label.name}}
                                        </td>
                                        <td>
                                            <span class="glyphicon glyphicon-remove"
                                                  style="color:red;"
                                                  ng-click="removeLabelLabelSet(label.id)">
                                            </span>
                                        </td>
                                    </tr>  
                                </tbody>
                            </table>
                            <div class="input-group col-lg-6">
                                <input type="text" ng-model="labelToAddLabelSet"
                                       class="form-control input-sm col-md-1"
                                       placeholder="Enter name...">
                                <span class="input-group-btn">
                                    <button class="btn btn-default btn-sm" type="button"
                                            ng-disabled="labelToAddLabelSet === undefined"
                                            ng-click="addLabelLabelSet(labelToAddLabelSet)">
                                        Add
                                    </button>
                                </span>
                            </div>
                        </div>
                        <div class="form-group sb_right">
                            <button type="button" class="btn btn-success"
                                    id ="sb_addLabelSetButton"
                                    ng-disabled="nameLabelSet === undefined || nameLabelSet === '' || selectedTargetsLabel.length < 1 || currentLabelSet.length < 1"
                                    ng-click="addLabelSet()">
                                Add label set
                            </button>
                        </div>
                    </div>
                    <!-- Link Sets -->
                    <div class="form-group col-xs-6 sb_right" id="scheme_add_links_div">
                        <label>
                            Add or modify link types:
                        </label>
                        <div class="form-group">
                            <label>
                                Name:
                            </label>
                            <input type="text" placeholder="Enter name...." 
                                   class="form-control input-sm" 
                                   ng-model="nameLinkSet"/>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-4">
                                Start type:
                            </label>
                            <div class = "btn-group sb_margin">
                                <select class="form-control input-sm"
                                        ng-options="target for target in this.targets"
                                        ng-model="startType">
                                </select>
                            </div>
                            <br/>
                            <label class="col-xs-4">
                                End type:
                            </label>
                            <div class = "btn-group">
                                <select class="form-control input-sm col-xs-1"
                                        ng-options="target for target in this.targets"
                                        ng-model="endType">
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                Labels:
                            </label>
                            <table class="form-group listingTable">
                                <tbody>
                                    <tr ng-repeat="label in this.currentLinkSet">
                                        <td class="tableRowWithGlyph">
                                            {{label.name}}
                                        </td>
                                        <td>
                                            <span class="glyphicon glyphicon-remove" 
                                                  style="color:red;"
                                                  ng-click="removeLabelLinkSet(label.id)">
                                            </span>
                                        </td>
                                    </tr>  
                                </tbody>
                            </table>
                            <div class="input-group">
                                <input type="text"
                                       ng-model="labelToAddLinkSet"
                                       class="form-control input-sm"
                                       placeholder="Enter name...">
                                <span class="input-group-btn">
                                    <button class="btn btn-default btn-sm" 
                                            type="button"
                                            ng-disabled="labelToAddLinkSet === undefined" 
                                            ng-click="addLabelLinkSet(labelToAddLinkSet)">
                                        Add
                                    </button>
                                </span>
                            </div>
                        </div>
                        <div class="form-group sb_right">
                            <button type="button" class="btn btn-success" id ="sb_addLinkSetButton"
                                    ng-disabled="startType === undefined || endType === undefined || currentLinkSet.length < 1"
                                    ng-click="addLinkSet()">
                                Add link set
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <uib-alert ng-repeat="alert in alerts"
                           type="{{alert.type}}"
                           dismiss-on-timeout="10000"
                           close="closeAlert($index)">
                    {{alert.msg}}
                </uib-alert>
            </div>
            <div class="modal-footer">
                <button id="sb_submitSchemeButton"
                        type="button"
                        class="btn btn-primary"
                        ng-click="submit()">Create and save scheme</button>
            </div>
        </form>

    </body>
</html>